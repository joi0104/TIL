## 20장 서버 사이드 렌더링

### 서버 사이드 렌더링

- UI를 서버에서 렌더링 하는 것
- 장점: 검색엔진이 페이지를 수집할 수 있다. 초기 렌더링 성능을 개선할 수 있다.
- 단점: 서버 리소스가 사용되기 때문에 캐싱이나 로드밸런싱을 해줘야 한다. 프로젝트 구조가 복잡해질 수 있다.

- 서버 사이드 렌더링과 코드 스플리팅의 충돌: 호환 작업 없이 두 기술을 함께 적용하면 다음과 같은 흐름으로 동작한다.
  - 서버 사이드 렌더링된 결과물이 브라우저에 나타난다.
  - 자바스크립트 파일 로딩이 시작된다.
  - 아직 불러오지 않은 컴포넌트를 null로 렌더링한다.
  - 페이지에서 코드 스플리팅된 컴포넌트들이 사라진다.
  - 코드 스플리팅된 컴포넌트들이 로딩된 이후 제대로 나타난다.
  - 이를 위해 **라우트 경로마다 코드 스플리팅된 파일 중에서 필요한 모든 파일을 브라우저에서 렌더링하기 전에** 불러와야 한다.

### 서버 사이드 렌더링 구현하기

1. `yarn eject` 명령어를 통해 웹팩 설정을 밖으로 꺼낸다.
2. `index.server.js` 와 같이 서버 사이드 렌더링용 엔트리를 만든다.
3. `config/paths.js` 에 `ssrIndexJs` 와 `ssrBuild` 정보를 추가한다.
4. `webpack.config.server.js` 를 작성하여 웹팩 환경설정파일을 만든다.
5. `webpack.config.server.js` 에 각 로더들을 설정한다. 이때, `css` 는 `onlyLocals:true ` 를 통해서 서버 사이드 렌더링에서 배제한다.
6. `yarn add webpack-node-externals` 를 통해서 번들링할 때는 `node_modules` 에서 불러오는 것을 제외하고 번들링하도록 설정한다.
7. `build.server.js` 를 작성하여 빌드 스크립트를 만든다.
