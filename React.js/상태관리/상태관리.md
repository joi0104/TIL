## 상태 관리

### 상태란 무엇일까?

- 정적인 document의 내용을 동적으로 변경하기 위해서 관리되는 동적인 데이터이다. 일반적으로 컴포넌트 안에서 관리되고 상태가 변함에 따라 리랜더링을 수행하여 상태의 변경을 document에 반영한다.
- 상태는 범위적인 측면으로 봤을때 몇몇 컴포넌트에 국한되서 고립되어 있는 `지역 상태`와 애플리케이션 어디서 든지 접근가능한 `전역 상태`로 나눌 수 있다.
- 역할적인 측면으로 봤을떄는 `UI상태`, `서버 캐시 상태`, `form 상태`, `URL 상태` 등이 있다.

### 상태 관리란 무엇일까?

- 상태 관리는 말그대로 상태를 관리하는 것을 말한다. 상태를 `어디에 두고`, `어떻게 분리하고`, `언제 어디서 초기화 해야하는지` 등등 상태를 관리하기 위한 일련의 작업들을 통틀어 상태 관리라고 말한다.

### 상태 관리는 어떻게 해야하나?

- 상태 관리에 대한 것은 딱히 정답이 없다. 개발자들은 여러가지 방법으로 상태를 관리하면서 자신만의 정답을 만들어 나가는 것이 좋다.

### 전통적인 상태 관리

- 기존의 상태관리는 `MVC` 패턴을 써서 UI를 관리하였다. `model`과 `view` 서로 연결되어있는 양방향 데이터 흐름을 가지고 있었기 떄문에 모델이 바뀌면 뷰가 바뀌며 뷰가 바뀌면 모델이 바뀌며 컨트롤러가 이를 조작하였다. 하지만 `model`에 의존되는 `view`가 많아질수록 컨트롤러의 복잡도도 더욱 올라갔다.
- 페이스북은 이러한 `MVC` 패턴의 복잡도를 해결하기 위해 단방향 흐름의 리액트를 내게 된다. 상위 컴포넌트에서 state를 선언하고 하위 컴포넌트로 props를 내려주는 구조를 가진 단방향 데이터 흐름은 상태의 전이를 없애주고 상태의 변경이 좀 더 예층 가능해질수 있었다. 하지만 하위 컴포넌트까지 state를 전달하기 위해 중간 컴포넌트들까지 필요없는 state를 props로 받는 `props drilling` 문제가 존재하였다.

### 전역 상태의 대두

- `props drilling`이 문제인 이유는 **자신에게 필요하지 않는 props를 가지고 있어야 한다**라는 문제점이 가장 크다. 자신의 책임을 수행하기 위해 필요한 props가 아닌 단순히 전달을 위한 props를 가지고 있어야 하기 때문에 코드의 중복이 늘어나고, 유지보수가 힘들어지며, 필요로 한 역할보다 더욱 방대한 역할을 가지고 있게된다.
- 이러한 `props drilling` 문제를 해결하기 위해서 상태를 전역에다 두는 전역 상태 라이브러리들이 등장하였고 이에 따라 `context API`, `redux`, `SWR`, `react-query`와 같은 여러 라이브러리들이 나올 수 있었다.

### 전역 상태는 만능이 아니다.

- `props drilling` 을 해결해주고 동적인 데이터인 상태의 전역적인 접근점을 제공함으로써 접근성을 높인다는 점에서 전역 상태는 획기적이었지만, 그럼에도 불구하고 전역 상태는 여러 문제를 가지고 있었다.
- 첫 번째로 예상치 못한 전역 상태 결과를 얻을 수 있다. 어플리케이션의 어디서든지 접근이 가능하기 때문에 어디서든지 전역 상태를 초기화 하고 갱신 할 수 있다. 따라서 전역 상태가 언제 초기화하고 언제 갱신하는지에 대한 파악이 제대로 이뤄지지 않으면 상태 값이 존재하지 않거나 의도치 않은 상태값을 가지거나 혹은 out-of-date 된 캐시 데이터를 상태로 가지게 될 수 있다.
- 두 번째로 관심사의 분리의 책임이 더욱 높아졌다. 관심사에 의해서 상태가 적절하게 분리되어 있지 않는다면 작은 상태 변화에도 많은 컴포넌트에서 리랜더링이 일어나야하는 부담이 존재한다.
- 즉, 두 가지를 정리하자면 전역적인 특성으로 인해서 지역 상태보다 좀 더 어렵고 고려할 것들이 많은 상태 관리가 이루어져야 한다는 것이다.

### 내가 생각하는 좋은 상태 관리란

- 따라서 나는 전역 상태는 최소한으로 가져야 한다고 생각한다. 최대한 관심있는 컴포넌트 끼리 지역적으로 상태를 가지고 있도록 하여 상태의 캡슐화를 잘 유지해야 한다고 생각한다.
- 또한 상태는 관련 컴포넌트들과 최대한 가까이 배치되는게 좋다고 생각한다. 멀수록 관련 없는 중간 컴포넌트들의 리랜더까 발생할 위험이 있고 컴포넌트들의 응집도를 떨어트릴 수 있으며 `props drilling`을 최소화 할 수 있다.
- 또한 상태는 관심사의 분리가 잘 되어야 한다고 생각한다 관심사에 따라 잘 분리되어 있지 않으면 결합도가 높아지고 사이드 이펙트가 일어날 가능성이 있으며 코드의 재사용성이나 유지보수 또한 떨어진다고 생각한다.

### 출처

- [https://jbee.io/react/thinking-about-global-state/](https://jbee.io/react/thinking-about-global-state/)
- [https://www.stevy.dev/react-state-management-guide](https://www.stevy.dev/react-state-management-guide)
